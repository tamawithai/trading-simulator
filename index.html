<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Perbandingan Simulasi Trading</title>
    <!-- Menggunakan Tailwind CSS untuk styling cepat dan modern -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Menggunakan font Inter untuk tampilan yang lebih profesional */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Memberi sedikit transisi untuk pengalaman yang lebih mulus */
        input {
            transition: all 0.2s ease-in-out;
        }
        /* Style untuk placeholder agar konsisten */
        input::placeholder {
            color: #9CA3AF;
        }
        /* Style untuk menyorot input yang aktif */
        .input-active {
            border-color: #3B82F6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-6 lg:p-8">
    <div class="max-w-7xl mx-auto">
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800">Dashboard Perbandingan Simulasi</h1>
            <p class="text-gray-500 mt-2">Isi dua dari tiga kolom pertama untuk memulai.</p>
        </div>

        <!-- Kontainer untuk 3 kolom kalkulator -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <!-- Kalkulator 1 -->
            <div class="calculator-card bg-white rounded-xl shadow-lg p-6 flex flex-col">
                <input type="text" class="coin-name text-lg font-bold text-gray-800 w-full border-b-2 border-transparent focus:border-blue-500 outline-none p-1 mb-4" placeholder="Nama Koin 1 (opsional)">
                <div class="space-y-4 flex-grow">
                    <p class="text-xs text-center text-gray-400 -mt-2">Isi 2 dari 3 kolom di bawah ini</p>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jumlah Modal (Rp)</label>
                        <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-modal w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="1.000.000"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Harga Beli / Aset (Rp)</label>
                        <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-buyPrice w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="Otomatis / Isi"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Aset Diperoleh</label>
                         <div class="relative">
                            <input type="text" class="input-assetQuantity w-full pl-4 pr-12 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="Otomatis / Isi">
                            <span class="coin-name-suffix absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">ASET</span>
                        </div>
                    </div>
                    <div class="h-px bg-gray-200 my-6"></div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Target Harga Jual / Aset (Rp)</label>
                        <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-sellPrice w-full pl-10 pr-4 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Target Keuntungan (Rp)</label>
                        <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-profitRp w-full pl-10 pr-4 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Target Keuntungan (%)</label>
                        <div class="relative"><input type="text" class="input-profitPercent w-full pl-4 pr-8 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"><span class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">%</span></div>
                    </div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 space-y-3">
                    <div class="flex justify-between items-center">
                        <p class="text-md font-medium text-gray-700">Total Nilai Penjualan</p>
                        <p class="total-after-profit text-xl font-bold text-green-600">Rp -</p>
                    </div>
                </div>
                <div class="mt-6 text-center"><button class="reset-button w-full bg-red-500 text-white font-bold py-2.5 px-4 rounded-md hover:bg-red-600 transition-colors">Reset</button></div>
            </div>

            <!-- Kalkulator 2 & 3 (Struktur sama) -->
            <div class="calculator-card bg-white rounded-xl shadow-lg p-6 flex flex-col">
                <input type="text" class="coin-name text-lg font-bold text-gray-800 w-full border-b-2 border-transparent focus:border-blue-500 outline-none p-1 mb-4" placeholder="Nama Koin 2 (opsional)">
                <div class="space-y-4 flex-grow">
                     <p class="text-xs text-center text-gray-400 -mt-2">Isi 2 dari 3 kolom di bawah ini</p>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Jumlah Modal (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-modal w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="1.000.000"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Harga Beli / Aset (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-buyPrice w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="Otomatis / Isi"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Aset Diperoleh</label><div class="relative"><input type="text" class="input-assetQuantity w-full pl-4 pr-12 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="Otomatis / Isi"><span class="coin-name-suffix absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">ASET</span></div></div>
                    <div class="h-px bg-gray-200 my-6"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Harga Jual / Aset (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-sellPrice w-full pl-10 pr-4 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Keuntungan (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-profitRp w-full pl-10 pr-4 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Keuntungan (%)</label><div class="relative"><input type="text" class="input-profitPercent w-full pl-4 pr-8 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"><span class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">%</span></div></div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 space-y-3"><div class="flex justify-between items-center"><p class="text-md font-medium text-gray-700">Total Nilai Penjualan</p><p class="total-after-profit text-xl font-bold text-green-600">Rp -</p></div></div>
                <div class="mt-6 text-center"><button class="reset-button w-full bg-red-500 text-white font-bold py-2.5 px-4 rounded-md hover:bg-red-600 transition-colors">Reset</button></div>
            </div>
            <div class="calculator-card bg-white rounded-xl shadow-lg p-6 flex flex-col">
                <input type="text" class="coin-name text-lg font-bold text-gray-800 w-full border-b-2 border-transparent focus:border-blue-500 outline-none p-1 mb-4" placeholder="Nama Koin 3 (opsional)">
                <div class="space-y-4 flex-grow">
                     <p class="text-xs text-center text-gray-400 -mt-2">Isi 2 dari 3 kolom di bawah ini</p>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Jumlah Modal (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-modal w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="1.000.000"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Harga Beli / Aset (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-buyPrice w-full pl-10 pr-4 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="Otomatis / Isi"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Aset Diperoleh</label><div class="relative"><input type="text" class="input-assetQuantity w-full pl-4 pr-12 py-2 bg-gray-50 border border-gray-300 rounded-md" placeholder="Otomatis / Isi"><span class="coin-name-suffix absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">ASET</span></div></div>
                    <div class="h-px bg-gray-200 my-6"></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Harga Jual / Aset (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-sellPrice w-full pl-10 pr-4 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Keuntungan (Rp)</label><div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">Rp</span><input type="text" class="input-profitRp w-full pl-10 pr-4 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"></div></div>
                    <div><label class="block text-sm font-medium text-gray-700 mb-1">Target Keuntungan (%)</label><div class="relative"><input type="text" class="input-profitPercent w-full pl-4 pr-8 py-2 bg-blue-50 border-gray-300 rounded-md" placeholder="Hasil"><span class="absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500">%</span></div></div>
                </div>
                <div class="mt-6 pt-4 border-t border-gray-200 space-y-3"><div class="flex justify-between items-center"><p class="text-md font-medium text-gray-700">Total Nilai Penjualan</p><p class="total-after-profit text-xl font-bold text-green-600">Rp -</p></div></div>
                <div class="mt-6 text-center"><button class="reset-button w-full bg-red-500 text-white font-bold py-2.5 px-4 rounded-md hover:bg-red-600 transition-colors">Reset</button></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const calculatorCards = document.querySelectorAll('.calculator-card');

        function formatRupiah(num) {
            if (isNaN(num) || num === null || num === 0) return '';
            // Format dengan titik sebagai pemisah ribuan
            return new Intl.NumberFormat('id-ID').format(Math.round(num));
        }
        
        function parseRupiah(str) {
            if (!str) return 0;
            // Hanya mengambil digit dari string
            return parseFloat(String(str).replace(/[^0-9]/g, '')) || 0;
        }

        function formatAsset(num) {
            if (isNaN(num) || num === null || num === 0) return '';
            // Format dengan koma sebagai pemisah desimal
            return num.toLocaleString('id-ID', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 8
            });
        }

        function parseAsset(str) {
            if (!str) return 0;
            // Mengganti koma dengan titik untuk parsing
            return parseFloat(String(str).replace(/\./g, '').replace(/,/g, '.')) || 0;
        }

        calculatorCards.forEach(card => {
            const coinNameEl = card.querySelector('.coin-name');
            const modalEl = card.querySelector('.input-modal');
            const buyPriceEl = card.querySelector('.input-buyPrice');
            const assetQuantityEl = card.querySelector('.input-assetQuantity');
            const sellPriceEl = card.querySelector('.input-sellPrice');
            const profitRpEl = card.querySelector('.input-profitRp');
            const profitPercentEl = card.querySelector('.input-profitPercent');
            const coinNameSuffixEl = card.querySelector('.coin-name-suffix');
            const totalAfterProfitEl = card.querySelector('.total-after-profit');
            const resetButton = card.querySelector('.reset-button');
            
            const primaryInputs = [modalEl, buyPriceEl, assetQuantityEl];
            const targetInputs = [sellPriceEl, profitRpEl, profitPercentEl];
            const allInputs = [...primaryInputs, ...targetInputs];
            const rupiahInputs = [modalEl, buyPriceEl, sellPriceEl, profitRpEl];
            const assetInputs = [assetQuantityEl, profitPercentEl];

            let isCalculating = false;

            function calculate(sourceEl) {
                if (isCalculating) return;
                isCalculating = true;

                let modal = parseRupiah(modalEl.value);
                let buyPrice = parseRupiah(buyPriceEl.value);
                let assetQuantity = parseAsset(assetQuantityEl.value);

                if (primaryInputs.includes(sourceEl)) {
                    if ((sourceEl === modalEl || sourceEl === buyPriceEl) && modal > 0 && buyPrice > 0) {
                        assetQuantity = modal / buyPrice;
                        if(document.activeElement !== assetQuantityEl) assetQuantityEl.value = formatAsset(assetQuantity);
                    } 
                    else if ((sourceEl === modalEl || sourceEl === assetQuantityEl) && modal > 0 && assetQuantity > 0) {
                        buyPrice = modal / assetQuantity;
                         if(document.activeElement !== buyPriceEl) buyPriceEl.value = formatRupiah(buyPrice);
                    } 
                    else if ((sourceEl === buyPriceEl || sourceEl === assetQuantityEl) && buyPrice > 0 && assetQuantity > 0) {
                        modal = buyPrice * assetQuantity;
                        if(document.activeElement !== modalEl) modalEl.value = formatRupiah(modal);
                    }
                    clearOutputs(targetInputs);
                }

                if (modal > 0 && assetQuantity > 0) {
                     let profit = 0;
                     let sellPrice = 0;

                    if (sourceEl === sellPriceEl) {
                        sellPrice = parseRupiah(sellPriceEl.value);
                        if (sellPrice > 0) {
                            profit = (sellPrice * assetQuantity) - modal;
                            profitRpEl.value = formatRupiah(profit);
                            profitPercentEl.value = formatAsset((profit / modal) * 100);
                        } else { clearOutputs([profitRpEl, profitPercentEl]); }
                    } else if (sourceEl === profitRpEl) {
                        profit = parseRupiah(profitRpEl.value);
                        sellPrice = (modal + profit) / assetQuantity;
                        sellPriceEl.value = formatRupiah(sellPrice);
                        profitPercentEl.value = formatAsset((profit / modal) * 100);
                    } else if (sourceEl === profitPercentEl) {
                        const percent = parseAsset(profitPercentEl.value) || 0;
                        profit = modal * (percent / 100);
                        sellPrice = (modal + profit) / assetQuantity;
                        profitRpEl.value = formatRupiah(profit);
                        sellPriceEl.value = formatRupiah(sellPrice);
                    }
                    
                    const finalValue = modal + profit;
                     if (finalValue >= modal && profit > 0) {
                       totalAfterProfitEl.textContent = 'Rp ' + formatRupiah(finalValue);
                    } else {
                       totalAfterProfitEl.textContent = 'Rp ' + formatRupiah(modal);
                    }
                } else {
                    clearOutputs(targetInputs);
                    totalAfterProfitEl.textContent = 'Rp -';
                }
                
                isCalculating = false;
            }

            function clearOutputs(elementsToClear) {
                elementsToClear.forEach(el => {
                    if(document.activeElement !== el) {
                       el.value = '';
                    }
                });
            }

            allInputs.forEach(el => {
                el.addEventListener('input', (e) => {
                    // PERBAIKAN: Format Rupiah saat mengetik
                    if (rupiahInputs.includes(el)) {
                        const originalValue = e.target.value;
                        const caretPos = e.target.selectionStart;
                        const numericValue = parseRupiah(originalValue);
                        
                        e.target.value = formatRupiah(numericValue);
                        
                        const newLength = e.target.value.length;
                        const oldLength = originalValue.length;
                        
                        // Menyesuaikan posisi kursor dengan cerdas
                        if (caretPos !== null) {
                            // Hitung jumlah titik yang ditambahkan/dihilangkan
                            const oldDots = (originalValue.match(/\./g) || []).length;
                            const newDots = (e.target.value.match(/\./g) || []).length;
                            e.target.setSelectionRange(caretPos + (newDots - oldDots), caretPos + (newDots - oldDots));
                        }
                    }
                    calculate(el);
                });
                
                el.addEventListener('focus', (e) => {
                    e.target.classList.add('input-active');
                });
                
                el.addEventListener('blur', (e) => {
                    e.target.classList.remove('input-active');
                     // PERBAIKAN: Format Aset/Persen saat fokus hilang
                    if (assetInputs.includes(el)) {
                        el.value = formatAsset(parseAsset(el.value));
                    }
                });
            });

            coinNameEl.addEventListener('input', () => {
                const name = coinNameEl.value.trim().toUpperCase() || 'ASET';
                coinNameSuffixEl.textContent = name;
            });

            resetButton.addEventListener('click', () => {
                allInputs.forEach(el => el.value = '');
                totalAfterProfitEl.textContent = 'Rp -';
            });
        });
    });
    </script>
</body>
</html>
